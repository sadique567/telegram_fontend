<!DOCTYPE html>
<html>
  <head>
    <title>Telegram Login</title>
    <meta charset="UTF-8" />
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #f0f0f0;
        text-align: center;
        margin-top: 60px;
      }
      .box {
        background: #fff;
        padding: 30px;
        max-width: 400px;
        margin: auto;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #0088cc;
      }
      #user-details {
        margin-top: 20px;
        padding: 15px;
        background: #e9f7ff;
        border-radius: 5px;
      }
      img {
        margin-top: 10px;
      }
    </style>
  </head>

  <body>
    <div class="box">
      <h1>Login with Telegram</h1>
      <p>Click below to login</p>

      <!-- ‚úÖ Telegram Widget -->
      <script
        async
        src="https://telegram.org/js/telegram-widget.js?22"
        data-telegram-login="flutter_login_bot"
        data-size="large"
        data-userpic="true"
        data-onauth="onTelegramAuth(user)"
      ></script>

      <div id="user-details"></div>
    </div>

    <script>
      function onTelegramAuth(user) {
        // Send Telegram data to backend
        fetch(
          "https://telegram-login-backend-gup5.onrender.com/auth/telegram",
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(user),
          }
        )
          .then((res) => res.json())
          .then((data) => {
            if (!data.success) {
              throw new Error(data.message || "Login failed");
            }

            const u = data.user;
            const detailsDiv = document.getElementById("user-details");

            detailsDiv.innerHTML = `
              <h2 style="color: green;">üéâ Login Successful</h2>
              <p><b>Telegram ID:</b> ${u.telegram_id}</p>
              <p><b>Name:</b> ${u.first_name} ${u.last_name}</p>
              <p><b>Username:</b> @${u.username || "N/A"}</p>
              ${
                u.photo_url
                  ? `<img src="${u.photo_url}" width="120" style="border-radius:50%;">`
                  : ""
              }
            `;
          })
          .catch((err) => {
            document.getElementById(
              "user-details"
            ).innerHTML = `<p style="color:red;">‚ùå ${err.message}</p>`;
          });
      }
    </script>
  </body>
</html>
