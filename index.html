<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Telegram Login</title>
    <style>
      body {
        font-family: Arial;
        background: #f0f0f0;
        text-align: center;
        margin-top: 60px;
      }
      .box {
        background: #fff;
        padding: 30px;
        max-width: 420px;
        margin: auto;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }
      .step {
        margin: 15px 0;
        padding: 12px;
        background: #fff3cd;
        border-radius: 6px;
        font-size: 14px;
      }
      #login-btn {
        display: none;
        margin-top: 15px;
      }
      #user-details {
        margin-top: 20px;
        background: #e9f7ff;
        padding: 10px;
        border-radius: 6px;
      }
    </style>
  </head>

  <body>
    <div class="box">
      <h2>Login with Telegram</h2>

      <!-- STEP 1 -->
      <div class="step">
        üîπ <b>Step 1:</b> First time users must start the bot <br /><br />
        <a href="https://t.me/flutter_login_bot" target="_blank">
          üëâ Open Telegram Bot & Press START
        </a>
      </div>

      <!-- STEP 2 -->
      <div class="step">
        üîπ <b>Step 2:</b> Come back and login
        <br />
        <button onclick="showLogin()">I have started the bot</button>
      </div>

      <!-- TELEGRAM LOGIN -->
      <div id="login-btn">
        <script
          async
          src="https://telegram.org/js/telegram-widget.js?22"
          data-telegram-login="flutter_login_bot"
          data-size="large"
          data-userpic="true"
          data-onauth="onTelegramAuth(user)"
        ></script>
      </div>

      <div id="user-details"></div>
    </div>

    <script>
      function showLogin() {
        document.getElementById("login-btn").style.display = "block";
      }

      function onTelegramAuth(user) {
        fetch(
          "https://telegram-login-backend-gup5.onrender.com/auth/telegram",
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(user),
          }
        )
          .then((res) => res.json())
          .then((data) => {
            if (!data.success) throw new Error(data.message);

            const u = data.user;
            document.getElementById("user-details").innerHTML = `
        <h3 style="color:green">üéâ Login Successful</h3>
        <p><b>ID:</b> ${u.telegram_id}</p>
        <p><b>Name:</b> ${u.first_name} ${u.last_name}</p>
        <p><b>Username:</b> @${u.username || "N/A"}</p>
        ${
          u.photo_url
            ? `<img src="${u.photo_url}" width="100" style="border-radius:50%">`
            : ""
        }
      `;
          })
          .catch((err) => {
            document.getElementById(
              "user-details"
            ).innerHTML = `<p style="color:red;">‚ùå ${err.message}</p>`;
          });
      }
    </script>
  </body>
</html>
